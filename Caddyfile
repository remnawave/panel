# global options
{
	admin off
	persist_config off
	auto_https off
	# log {
	#	format json
	# }
	servers {
		trusted_proxies static private_ranges 100.0.0.0/8
	}
}

:{$PORT:8080} {
	handle /health {
		respond "OK" 200
	}

	@notMainDomain {
		not header Host docs.rw
	}
	redir @notMainDomain https://docs.rw{uri} permanent

	@mainDomain {
		header Host docs.rw
	}

	handle @mainDomain {
		redir /blog/learn /docs/learn/quick-start permanent
		redir /blog/learn/quick-start /docs/learn/quick-start permanent
		redir /docs/install/reverse-proxies/ /docs/install/reverse-proxies/ permanent
		redir /docs/ /docs/overview/introduction permanent
		redir /apps /docs/clients permanent
		redir /client /docs/clients permanent
		redir /donate /docs/donate permanent
		redir /blog/learn /docs/learn/quick-start permanent
		redir /blog/learn/quick-start /docs/learn/quick-start permanent

		root * /app/build
		encode gzip
		file_server
		try_files {path} /index.html

		header {
			X-Content-Type-Options "nosniff"
			X-Frame-Options "DENY"
			X-XSS-Protection "1; mode=block"
		}
	}
}
